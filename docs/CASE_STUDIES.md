# ケーススタディ：pachislot-setting-prediction

実際のプロジェクトで行った技術判断と設計判断の事例集。

## プロジェクト概要

**プロジェクト名**: pachislot-setting-prediction
**目的**: パチスロ店の設定予想サイト
**期間**: 2025年10月
**技術スタック**: Laravel 12, Breeze, MySQL, Tailwind CSS
**開発手法**: Miyabi + Claude Code協調開発

---

## Case 1: Google OAuth 見送り判断

### 背景

ユーザー認証機能として、Google OAuthを利用したソーシャルログインを検討。

### 検討内容

#### コスト評価

| 項目 | 内容 | 判断 |
|------|------|------|
| 初期費用 | 無料（Google Cloud Console設定のみ） | ✅ |
| 月額費用 | 無料枠あり | ✅ |
| 使用量課金 | **API呼び出し数に応じて課金の可能性** | ⚠️ |
| スケール時 | ユーザー数増加で課金リスク | ❌ |

#### 技術評価

| 項目 | 内容 | 判断 |
|------|------|------|
| 自前実装 | Laravel Breezeで十分 | ✅ |
| 代替手段1 | Laravel Breeze（メール/パスワード） | ✅ |
| 代替手段2 | GitHub OAuth（無料） | ✅ |
| 保守性 | Google API仕様変更リスク | ⚠️ |

### 判断

**❌ 見送り**

**理由**:
1. コスト不確実性（有料化リスク）
2. 自前実装（Laravel Breeze）で要件充足
3. 小規模プロジェクトには過剰

### 実装内容

- Laravel Breeze（メール/パスワード認証）
- テストユーザー作成
- 開発者アカウント作成（Seeder）

### 学び

- **無料≠コストゼロ**: 使用量課金は予測困難
- **最小実装から始める**: 後から拡張可能
- **要件を満たす最小の技術を選ぶ**

---

## Case 2: チャットボット見送り判断

### 背景

サイト開発に関する質問に答えるチャットボット機能を検討。

### 検討内容

#### 方式1: 外部LLM API（OpenAI, Claude）

**コスト評価**:
```
OpenAI API: $0.002/1k tokens
月間想定: 100万tokens
月額: $200〜$300
```

**判断**: ❌ 高コスト

#### 方式2: ローカルLLM（Ollama + Llama）

**技術評価**:
- サーバースペック: 共有サーバー（ロリポップ）
- 必要スペック: 8GB RAM, GPU推奨
- 現状スペック: 不足

**判断**: ❌ サーバースペック不足

#### 方式3: ルールベースFAQ

**技術評価**:
- 工数: 大（FAQ作成、ルール定義）
- 柔軟性: 低（事前定義のみ）
- コスト: 無料

**判断**: ⚠️ 簡易的

#### 方式4: FAQページ + お問い合わせフォーム

**技術評価**:
- 工数: 小
- 柔軟性: 中
- コスト: 無料

**判断**: ✅ 現実的

### 判断

**❌ チャットボット見送り**
**✅ 代替案4を採用**

**理由**:
1. 本格的なLLMは高コスト
2. ローカルLLMはサーバースペック不足
3. ルールベースは実装コスト高
4. FAQページで当面対応可能

### 実装内容

- （将来的な拡張機能として検討）
- まずは基本機能（認証、店舗管理）を優先

### 学び

- **高コスト機能は後回し**: MVP完成後に検討
- **代替手段の検討**: 同じ目的を達成する別の方法
- **将来的な拡張として残す**: 完全に諦めるのではなく、優先順位を下げる

---

## Case 3: 役割ベースアクセス制御（RBAC）実装

### 背景

開発者用と利用者用で異なる画面・機能を提供したい。

### 検討内容

#### 方式1: 外部パッケージ（spatie/laravel-permission）

**技術評価**:
- 機能: 高機能（ロール、パーミッション、階層構造）
- 学習コスト: 中
- 要件適合: **過剰**（2ロールのみ）

**判断**: ⚠️ オーバースペック

#### 方式2: 自前実装（enum型カラム）

**技術評価**:
- 機能: シンプル（2ロール）
- 学習コスト: 低
- 要件適合: ✅ 十分

**判断**: ✅ 最適

### 判断

**✅ 自前実装**

**理由**:
1. 要件がシンプル（user / developer の2ロールのみ）
2. 外部パッケージは過剰
3. 保守性が高い（理解しやすい）

### 実装内容

**マイグレーション**:
```php
$table->enum('role', ['user', 'developer'])->default('user');
```

**ミドルウェア**:
```php
class EnsureDeveloper
{
    public function handle(Request $request, Closure $next): Response
    {
        if ($request->user()->role !== 'developer') {
            abort(403);
        }
        return $next($request);
    }
}
```

**ルーティング**:
```php
// 開発者のみ
Route::middleware(['auth', 'developer'])->group(function () {
    Route::get('/developer/dashboard', ...);
});

// 利用者
Route::middleware(['auth'])->group(function () {
    Route::get('/user/dashboard', ...);
});
```

### 学び

- **YAGNI原則**: 今必要ない機能は実装しない
- **シンプルさは武器**: 理解しやすいコードは保守しやすい
- **拡張性は考慮**: 将来3ロール目が必要になったら、その時検討

---

## Case 4: デプロイ先サーバー選定

### 背景

外出先からサイトにアクセスできるよう、本番環境が必要。

### 検討内容

#### 選択肢1: 共有サーバー（ロリポップ）

| 項目 | 内容 | 判断 |
|------|------|------|
| 月額 | 800円 | ✅ |
| スペック | PHP 8.2, MySQL, SSH | ✅ |
| 想定規模 | 〜100ユーザー/日 | ✅ |
| 運用負荷 | 低（管理画面で設定） | ✅ |

**判断**: ✅ 最適

#### 選択肢2: VPS

| 項目 | 内容 | 判断 |
|------|------|------|
| 月額 | 2000円〜 | ⚠️ |
| 運用負荷 | 高（サーバー管理必要） | ❌ |
| 想定規模 | 小規模には過剰 | ❌ |

**判断**: ⚠️ 過剰

### 判断

**✅ ロリポップ スタンダードプラン**

**理由**:
1. MVP段階では共有サーバーで十分
2. 低コスト（800円/月）
3. 運用負荷が低い
4. スケールアップ可能（後からVPSへ移行）

### 実装内容

- `.env.production` テンプレート作成
- DEPLOY.md（デプロイ手順書）作成
- フロントエンドアセットのビルド

### 学び

- **小さく始める**: MVP段階で高スペックは不要
- **移行計画を考慮**: 負荷に応じてVPSへ移行可能
- **ドキュメント化**: 手順書があれば再現可能

---

## Case 5: Miyabiタスク分解の活用

### 背景

複雑な機能実装時に、タスクの見落としを防ぎたい。

### 実績データ

| Issue | 機能 | タスク数 | 分解時間 | 結果 |
|-------|------|---------|---------|------|
| #2 | Miyabi調査 | 4タスク | 647ms | ✅ |
| #3 | 役割管理 | 4タスク | 397ms | ✅ |
| #4 | デプロイ準備 | 4タスク | 313ms | ✅ |

### 判断

**✅ 10+ファイルの機能実装時にMiyabi使用**

**理由**:
1. タスク分解が高速（300〜650ms）
2. 見落とし防止
3. 依存関係の明確化

### 実装パターン

```bash
# 1. Issue作成
gh issue create --title "役割管理機能" --body "..."

# 2. Miyabiでタスク分解
miyabi agent coordinator --issue 3

# 3. Claude Codeで実装
"Issue #3の実装をお願いします"

# 4. 完了
gh issue close 3
```

### 学び

- **適材適所**: 大規模機能はMiyabi、小規模は直接実装
- **高速分解**: 手動より圧倒的に速い
- **LLM不要**: ルールベースでも十分有効

---

## まとめ

### 意思決定の原則

1. **コスト優先**: 月額1000円以下を目安
2. **YAGNI**: 今必要ない機能は実装しない
3. **シンプル・イズ・ベスト**: 理解しやすいコードを書く
4. **小さく始める**: MVPから徐々に拡張
5. **代替案検討**: 必ず2つ以上の選択肢を比較

### 技術選定フロー

```
新機能検討
  ↓
コスト評価（月額1000円以下？）
  ↓
技術評価（自前実装と比較）
  ↓
代替案検討（2つ以上）
  ↓
判断・実装
```

### 次のプロジェクトへ

このケーススタディを参考に、同様の判断が必要な場面で活用してください。

**チェックポイント**:
- [ ] コストは予算内か？
- [ ] 自前実装と比較したか？
- [ ] 代替案を2つ以上検討したか？
- [ ] 要件を満たす最小の技術か？
- [ ] 将来の拡張性は考慮したか？

---

**関連ドキュメント**:
- [技術選定チェックリスト](./TECH_DECISION_GUIDE.md)
- [サーバープラン選定ガイド](./SERVER_PLANNING.md)
- [開発ワークフロー](./DEVELOPMENT_WORKFLOW.md)
