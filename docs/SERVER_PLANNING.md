# サーバープラン選定ガイド

プロジェクト規模に応じた適切なサーバー環境を選定するためのガイド。

## 目的

- コストパフォーマンスの最適化
- スケーラビリティの確保
- パフォーマンス要件の充足
- 運用負荷の軽減

## 想定規模別プラン

### 小規模（〜100ユーザー/日、月間PV: 〜3000）

#### 推奨プラン: 共有サーバー

**具体例**:
- ロリポップ スタンダードプラン
- さくらインターネット スタンダード
- エックスサーバー スタンダード

**スペック目安**:
```
CPU: 共有（制限あり）
メモリ: 非公開（通常512MB〜1GB相当）
ストレージ: 100GB〜200GB
転送量: 無制限または大容量
PHP: 8.2以上
MySQL: 5.7以上
SSL: 無料（Let's Encrypt）
```

**月額コスト**: 500円〜1,000円

**メリット**:
- ✅ 低コスト
- ✅ 管理画面でかんたん設定
- ✅ SSL証明書無料
- ✅ 自動バックアップあり

**デメリット**:
- ❌ リソース制限あり
- ❌ root権限なし
- ❌ カスタマイズ性低い

**適用プロジェクト**:
- MVP・プロトタイプ
- 個人プロジェクト
- 社内ツール（小規模）

### 中規模（100〜1,000ユーザー/日、月間PV: 3,000〜30,000）

#### 推奨プラン: VPS

**具体例**:
- さくらVPS 2Gプラン
- ConoHa VPS 2GBプラン
- Vultr High Frequency 2GB

**スペック目安**:
```
CPU: 2コア
メモリ: 2GB〜4GB
ストレージ: 50GB〜100GB SSD
転送量: 無制限または大容量
PHP: 自由（8.2以上推奨）
MySQL: 自由（8.0推奨）
SSL: Let's Encrypt（自分で設定）
```

**月額コスト**: 2,000円〜5,000円

**メリット**:
- ✅ root権限あり
- ✅ カスタマイズ自由
- ✅ パフォーマンス安定
- ✅ スケールアップ可能

**デメリット**:
- ❌ サーバー管理が必要
- ❌ セキュリティ対策が必要
- ❌ バックアップは自己責任

**適用プロジェクト**:
- 本格的なWebアプリケーション
- BtoBサービス
- 会員制サイト

### 大規模（1,000ユーザー/日〜、月間PV: 30,000〜）

#### 推奨プラン: クラウド（オートスケーリング）

**具体例**:
- AWS (EC2 + RDS + CloudFront)
- Google Cloud Platform (Compute Engine + Cloud SQL)
- Microsoft Azure

**スペック目安**:
```
CPU: 変動（オートスケーリング）
メモリ: 変動（オートスケーリング）
ストレージ: S3/Cloud Storage（無制限）
CDN: CloudFront/Cloud CDN
Database: RDS/Cloud SQL（マネージド）
キャッシュ: ElastiCache/Memorystore
```

**月額コスト**: 10,000円〜（変動）

**メリット**:
- ✅ 無限スケーラビリティ
- ✅ 高可用性（99.99%）
- ✅ グローバル配信
- ✅ マネージドサービス豊富

**デメリット**:
- ❌ コスト予測が難しい
- ❌ 設定・管理が複雑
- ❌ ベンダーロックイン

**適用プロジェクト**:
- 大規模Webサービス
- BtoCサービス
- グローバル展開

## サーバースペックとパフォーマンスの目安

### レスポンスタイム目標

| ページ種別 | 目標時間 | 許容時間 |
|-----------|---------|---------|
| トップページ | < 1秒 | < 2秒 |
| 一覧ページ | < 1秒 | < 2秒 |
| 詳細ページ | < 0.5秒 | < 1秒 |
| API | < 200ms | < 500ms |

### スループット目標

| サーバー種別 | 目標 | 備考 |
|-------------|------|------|
| 共有サーバー | 10 req/sec | 同時接続制限あり |
| VPS (2GB) | 50 req/sec | キャッシュ有効時 |
| VPS (4GB) | 100 req/sec | キャッシュ有効時 |
| クラウド | 1000+ req/sec | オートスケーリング |

## 負荷テストの実施

### Apache Bench (ab)を使った負荷テスト

```bash
# 100リクエスト、同時接続10でテスト
ab -n 100 -c 10 https://your-domain.com/

# 結果の見方
# Requests per second: 50.00 [#/sec]  ← スループット
# Time per request: 200.000 [ms]      ← レスポンスタイム
```

### 目標値

```
共有サーバー: 10 req/sec, < 1000ms
VPS: 50 req/sec, < 500ms
クラウド: 100+ req/sec, < 200ms
```

### 負荷テストチェックリスト

- [ ] トップページの負荷テスト
- [ ] 認証ページの負荷テスト
- [ ] データベースクエリの多いページ
- [ ] 画像・アセットの配信速度
- [ ] API エンドポイント

## 移行計画

### 小規模 → 中規模（共有サーバー → VPS）

**移行タイミング**:
- 日次アクティブユーザーが100人を超える
- レスポンスタイムが2秒を超える
- リソース制限エラーが頻発

**移行手順**:
1. VPSの準備（環境構築）
2. データベースのエクスポート
3. ファイルの転送
4. DNS切り替え
5. 動作確認

**ダウンタイム**: 1〜2時間

### 中規模 → 大規模（VPS → クラウド）

**移行タイミング**:
- 日次アクティブユーザーが1000人を超える
- スケールアップでも負荷に対応できない
- 可用性99.9%以上が必要

**移行手順**:
1. クラウド環境の設計（マルチAZ等）
2. ステージング環境での検証
3. データベース移行（RDS等）
4. アプリケーション移行
5. CDN設定
6. DNS切り替え
7. 段階的トラフィック移行

**ダウンタイム**: ほぼゼロ（Blue-Green デプロイ）

## コスト試算例

### 小規模プロジェクト（パチスロ設定予想サイト）

```
サーバー: ロリポップ スタンダード  800円/月
ドメイン: .com                   1,500円/年 (125円/月)
SSL: 無料（Let's Encrypt）       0円
合計: 約925円/月
```

### 中規模プロジェクト

```
VPS: さくらVPS 2G              1,900円/月
ドメイン: .com                  1,500円/年 (125円/月)
SSL: 無料（Let's Encrypt）      0円
バックアップ: 自動バックアップ    400円/月
合計: 約2,425円/月
```

### 大規模プロジェクト

```
AWS EC2 (t3.medium × 2)        約6,000円/月
RDS (db.t3.medium)             約5,000円/月
CloudFront (CDN)               約2,000円/月
S3 (ストレージ)                 約500円/月
Route53 (DNS)                  約50円/月
合計: 約13,550円/月〜
```

## チェックリスト

### サーバー選定時

- [ ] 想定ユーザー数は？
- [ ] 月間PV数は？
- [ ] データベースサイズは？
- [ ] ファイルストレージ容量は？
- [ ] 予算は？
- [ ] 運用体制は？（専任エンジニアの有無）

### プラン変更検討時

- [ ] 現在のリソース使用率は？（CPU, メモリ）
- [ ] レスポンスタイムは目標値内か？
- [ ] エラー率は許容範囲か？
- [ ] コストは予算内か？
- [ ] スケールアップで対応可能か？

## まとめ

### 選定フロー

```
プロジェクト開始
  ↓
個人・MVP・社内ツール？ → YES → 共有サーバー（500〜1000円/月）
  ↓ NO
本格的なWebサービス？ → YES → VPS（2000〜5000円/月）
  ↓ NO
大規模・グローバル展開？ → YES → クラウド（10000円〜/月）
```

### 重要ポイント

1. **小さく始めて、必要に応じてスケールアップ**
2. **負荷テストで定量評価**
3. **移行計画は早めに検討**
4. **コストとパフォーマンスのバランス**
5. **運用負荷も考慮**

---

**関連ドキュメント**:
- [技術選定チェックリスト](./TECH_DECISION_GUIDE.md)
- [パフォーマンス最適化ガイド](./PERFORMANCE_OPTIMIZATION.md)
- [ケーススタディ](./CASE_STUDIES.md)
